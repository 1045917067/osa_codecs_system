################################################################################
#
#	The makefile for DVR_RDK demos.
#
################################################################################

# include global Rules.mak

CODEGEN_PATH_HOST:= ~/workingshop/arago
CODEGEN_PREFIX   := $(CODEGEN_PATH_HOST)/bin/arm-arago-linux-gnueabi-
linuxdevkit_PATH := $(CODEGEN_PATH_HOST)/arm-arago-linux-gnueabi
CC=$(CODEGEN_PREFIX)gcc

TARGET := $(notdir $(CURDIR))

VERBOSE :=true
ifeq ($(VERBOSE), true)
	override VERBOSE =
else
	override VERBOSE = @
endif

OPTION +=

INCLUDE += -I"include" -I"../osa/include"

C_FLAGS  += $(INCLUDE)
LD_FLAGS += -lpthread -lrt -lm -lasound

# Modules subdirectory
DEMO_MODULE_SRC := src
DEMO_MODULE_INC := include

# The source files
SOURCES := $(wildcard $(DEMO_MODULE_SRC)/*.c)

# The header files.
HEADERS := $(wildcard $(DEMO_MODULE_INC)/*.h)

COMPILE.c := $(VERBOSE) $(CC) $(C_FLAGS) $(CPP_FLAGS) $(OPTION)
LINK.c    := $(VERBOSE) $(CC) $(LD_FLAGS)

# The object files.
OBJFILES 	 := $(SOURCES:%.c=%.o)

# The exec file.
EXEC_FILE  := $(addprefix codecs_system_, $(strip $(TARGET)))
EXEC_FILE  := $(addsuffix .bin, $(strip $(EXEC_FILE)))

.PHONY : all clean

all: $(TARGET)

$(TARGET): PRINTMSG $(EXEC_FILE)
	@echo
	@echo Finished to build $(TARGET) module.
	@echo
 
PRINTMSG:
	@echo Begin to build $(TARGET) module...

$(EXEC_FILE): $(OBJFILES)
	@$(LINK.c) -o $@ $^ -L"lib" -lcodecs -L"$(linuxdevkit_PATH)/usr/lib"
	
$(OBJFILES):	%.o: %.c $(HEADERS)
	$(COMPILE.c) -o $@ -c $< 

clean:
	@echo Removing files generated by compiler...
	$(VERBOSE) $(RM) -rf $(OBJFILES) $(EXEC_FILE)
	@echo Finished to remove files generated by compiler.

#
# The end of makefile.
#
